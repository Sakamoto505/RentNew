<!DOCTYPE html>
<html>
<head>
  <title>Логины и пароли пользователей</title>
  <meta charset="utf-8">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; word-break: break-word; }
    th { background-color: #f2f2f2; position: sticky; top: 0; }
    .role { padding: 4px 8px; border-radius: 4px; color: white; font-size: 12px; }
    .role.admin { background-color: #dc3545; }
    .role.company { background-color: #007bff; }
    .role.client { background-color: #28a745; }
    .password { 
      font-family: monospace; 
      background: #f8f9fa; 
      padding: 2px 4px; 
      border-radius: 3px;
      color: #666;
      cursor: pointer;
      user-select: all;
    }
    .password:hover { background: #e9ecef; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .back-link { color: #007bff; text-decoration: none; }
    .back-link:hover { text-decoration: underline; }
    .warning {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Логины и пароли пользователей</h1>
    <%= link_to "← Назад к компаниям", admin_panel_index_path, class: "back-link" %>
  </div>

  <div class="warning">
    <strong>⚠️ Внимание:</strong> Эта страница содержит конфиденциальную информацию. Пароли отображаются в зашифрованном виде (bcrypt hash).
  </div>

  <p>Всего пользователей: <%= @users.count %></p>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Email (Логин)</th>
        <th>Роль</th>
        <th>Название компании</th>
        <th>Пароль (hash)</th>
        <th>Дата создания</th>
        <th>Последний вход</th>
      </tr>
    </thead>
    <tbody>
      <% @users.each do |user| %>
        <tr>
          <td><%= user.id %></td>
          <td><%= user.email %></td>
          <td>
            <span class="role <%= user.role %>">
              <%= user.role.humanize %>
            </span>
          </td>
          <td><%= user.company_name || '-' %></td>
          <td>
            <span class="password" title="Нажмите чтобы выделить">
              <%= user.encrypted_password.truncate(50) %>
            </span>
          </td>
          <td><%= user.created_at.strftime("%d.%m.%Y %H:%M") %></td>
          <td>
            <%= user.current_sign_in_at ? user.current_sign_in_at.strftime("%d.%m.%Y %H:%M") : 'Никогда' %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <div style="margin-top: 20px; font-size: 14px; color: #666;">
    <p><strong>Примечание:</strong> Пароли хранятся в зашифрованном виде (bcrypt). Восстановить оригинальный пароль невозможно.</p>
    <p>Для сброса пароля пользователя используйте Rails console: <code>User.find(ID).update(password: 'новый_пароль')</code></p>
  </div>
</body>
</html>